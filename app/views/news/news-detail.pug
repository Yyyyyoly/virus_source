extends ../layout/base

block stylesheet
  style .news .count-type{background-color:#01d491;color:#fff;font-size:1.2rem;padding-top:.5rem;padding-bottom:.5rem}.news .count-type .nav{justify-content:center}.news .count-type .nav-link{width:6rem;text-align:center}.news .count-type .nav-link.active{background-color:transparent;border-radius:0}.news .count-type .nav-link.active:before{content:"";position:absolute;bottom:0;background-color:#fff;height:.3rem;width:3.2rem;border-radius:.5rem}.news .news-type{color:#666}.news .news-type .col{padding:1rem 0}.news .news-type .nav{overflow-x:auto;flex-wrap:nowrap}.news .news-type .nav::-webkit-scrollbar{display:none}.news .news-type .nav .nav-item{width:25%}.news .news-type .nav .nav-link{text-align:center;margin:0 1rem;padding:.2rem 0}.news .news-type .nav .nav-link.active{background-color:#01d491;color:#fff;border-radius:3rem}.news .news-block{margin-bottom:1rem}.news .news-block .row{background-color:#fff}.news .news-block h5{padding-top:1rem}.news .news-block small{color:#979797;font-size:.8rem;float:right;line-height:1.5rem}.news .news-block .abstract{color:#999;font-size:.9rem;margin-top:1rem;line-height:1.6rem}.news .news-block .info{color:#999;font-size:.8rem;margin-top:1rem;line-height:1.8rem}.news .news-block .info span{margin-right:1.5rem}.news .news-block .info button{position:absolute;right:1rem;color:#01d491;border-color:#01d491;border-radius:3rem;padding:.2rem .8rem}.news .news-block img{width:100%}.news .news-detail{background-color:#fff;padding-bottom:.5rem}.news .news-detail p{margin-top:.5rem}.news .news-detail .info{color:#979797;padding-right:1rem;margin-bottom:.5rem}.news .news-detail button{color:#979797;padding:0;background-color:transparent;border:none;outline:none}.news .news-detail button.thumb{color:#01d491}.news .news-detail button.thumb span{color:#979797}.news .news-detail span{margin-right:1rem}.news .news-detail img{background-color:#eee;width:100%}.news .news-thumb button{background-color:transparent;border:none;outline:none}.news .news-thumb button.thumb{color:#01d491}.news .news-thumb .info{color:#979797;padding-right:1rem;margin-bottom:.5rem;font-size:.8rem}.news .news-thumb span{margin-right:1rem}.news .news-share button{padding:.2rem 1.5rem;color:#01d491;background-color:transparent;border-color:#01d491;border-radius:3rem;font-size:.8rem}.news .news-share p{margin-top:.5rem;margin-bottom:.5rem;color:#a5a5a5;font-size:.8rem}.news .discuss form button{border-color:#01d491;color:#01d491}.news .discuss form textarea{background-color:#f4f4f4}.news .discuss .row{background-color:#fff}.news .discuss .edit-bar{color:#01d491}.news .discuss .edit-bar p{margin:.5rem 0}.news .discuss .user-id{color:#999;margin-bottom:.1rem}.news .discuss .discuss-block{padding-bottom:2rem}.news .discuss .icon{width:3.5rem;height:3.5rem;margin-left:1rem;background-color:#eee;border-radius:100%}
block title
  title #{title}
block content
  .container.news#newsDetailPage(v-cloak)
    .row.news-detail: .col
      p.info
        span {{timeFormat(pageInfo.createdAt)}}
        span 迈德科技
      .d-block(v-html='pageInfo.context')
      p.info
        span 浏览数：{{pageInfo.pv}}
        button(:class="pageInfo.ifThumb ? 'thumb' : ''", @click= 'thumbUp')
          i.fa.fa-thumbs-o-up
          span &ensp;点赞数：{{pageInfo.thumbUp}}
    .row.news-share: .col.text-center
      //p: button.btn 分享
      p
    .discuss
      .row.edit-bar
        p.col: a(href="#commentArea", data-toggle="collapse") 写评论&nbsp;
          i.fa.fa-edit
      .row#commentArea.collapse
        form.col
          .form-group.sr-only
            label
            input.form-control(v-model= 'form.newsId', :value='pageInfo.newsId')
          .form-group
            label.sr-only
            textarea.form-control(v-model= 'form.comment', rows= 3)
          button.btn.btn-outline-success.btn-sm.float-right(@click= 'submitComment', type= 'button', style='margin-bottom:1rem') 提交
          .clearfix

      .row: .col
        hr(style='margin-top: 0')

      .row.discuss-block(v-for="comment in pageInfo.commentList")
        .icon: img.img-fluid(:src='comment.headImgUrl')
        .col
          p.user-id.small {{comment.userName}}
          p.content {{comment.comment}}

  include ../layout/navbar-bottom

block script

  script.
    var vm = new Vue({
      el: '#newsDetailPage',
      data: {
        pageInfo: !{JSON.stringify(pageInfo)},
        form: {
          newsId: '#{pageInfo.newsId}',
          comment: ''
        }
      },
      methods: {
        timeFormat: function (e) {
          return moment(e).format('YYYY-MM-DD HH:mm')
        },
        submitComment: function () {
          $.post('/news/details/operator/comment', {
            newsId: this.form.newsId,
            comment: this.form.comment
          }, function (data) {
            if (data.errCode === 200) {
              alert('提交成功！');
              vm.pageInfo.commentList = data.params.commentList;
              vm.form.comment = '';
              $('#commentArea').collapse('hide');
            }
          }, 'json')
        },
        thumbUp: function () {
          if (!this.ifThumb) {
            $.get('/news/details/operator/thumb', {
              newsId: this.form.newsId
            }, function (data) {
              if (data.errCode === 200) {
                vm.pageInfo.ifThumb = true;
                vm.pageInfo.thumbUp = JSON.parse(data.params.newThumbUpNum);
              }
            }, 'json')
          }
        }
      }
    });
  script.
    wx.config(!{JSON.stringify(wxConfig)});
    wx.ready(function () {
      wx.onMenuShareTimeline({
        title: '#{pageInfo.title}', // 分享标题
        link: '#{shareLink}', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
        imgUrl: '#{pageInfo.imgUrl}', // 分享图标
        success: function () {
          // 用户确认分享后执行的回调函数
          $.post('/news/share/#{pageInfo.newsId}', {
            shareId: '#{shareUid}'
          }, function (data) {
            if (data && data.errCode === 200) {
              alert('分享成功!')
            }
          }, 'json')
        },
        cancel: function () {
          // 用户取消分享后执行的回调函数
        }
      });
      wx.onMenuShareAppMessage({
        title: '#{pageInfo.title}', // 分享标题
        desc: '#{pageInfo.introduction}', // 分享描述
        link: '#{shareLink}', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
        imgUrl: '#{pageInfo.imgUrl}', // 分享图标
        type: '', // 分享类型,music、video或link，不填默认为link
        dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
        success: function () {
          // 用户确认分享后执行的回调函数
          $.post('/news/share/#{pageInfo.newsId}', {
            shareId: '#{shareUid}'
          }, function (data) {
            if (data && data.errCode === 200) {
              alert('分享成功!')
            }
          }, 'json')
        },
        cancel: function () {
          // 用户取消分享后执行的回调函数
        }
      });
    })